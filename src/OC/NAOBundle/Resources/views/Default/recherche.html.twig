{% extends 'OCNAOBundle::layout.html.twig' %}

{% block body %}
<style>
  #map {
    height: 50%;
  }
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  .container {
    width: 90%;
    padding-top: 20px;
  }
</style>

<div class="container">
  <div class="row">
    <div class="formulaire col-md-6">
    <h1>Recherche</h1>

    {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}
      {{ form_errors(form) }}

      {{ form_row(form.espece, {
        'label': "Nom de l'espece",
        'attr': {
					'data-id': 'listedesespeces',
					'data-url': path('ocnao_autocomplete')
          }
        })
      }}

      {{ form_row(form.submit, {'label': 'Envoyer'}) }}
      {{ form_end(form) }}
    </div>
  </div>
</div>
<script>
$("input[data-id=listedesespeces]").autocomplete({
    source: function (request, response) {
        var oiseau = $("input[data-id=listedesespeces]").val();
        var objData = 'oiseau=' + oiseau;
        var url = $(this.element).attr('data-url');

        $.ajax({
            url: url,
            dataType: "json",
            data : objData,
            type: 'POST',
            success: function (data) {
                response($.map(data, function (espece) {
                    return {
                    label: espece.nomVern
                    }
                }));
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log(textStatus, errorThrown);
            }
        });
    }
  })
  //Affichage et récupération de la valeur sélectionnée
  $("input[data-id=listedesespeces]").on('autocompleteselect',function(event, ui) {

  	event.preventDefault();

      var contact = ui.item.label;
          id = ui.item.value;
      console.log('Event: ', event);
      console.log('UI :', ui.item);
      $(event.currentTarget).val(contact);

  });
</script>
</body>

{% endblock %}
